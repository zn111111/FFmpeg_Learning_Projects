# 基于FFmpeg的音视频分离（不涉及编解码）

这是一个使用FFmpeg对音视频进行分离的小项目。例如，输入一个.mp4的视频文件，可以输出一个.h264的视频码流和一个.aac的音频码流。

项目中使用的函数的讲解见[FFmpeg库常用函数介绍-CSDN博客](https://blog.csdn.net/m0_51496461/article/details/135315126?spm=1001.2014.3001.5502)

整个项目的原理其实并不复杂。

1、 打开输入文件，初始化输入AVFormatContext，然后寻找流信息以及编解码信息；

2、 创建输出视频以及音频的AVFormatContext；

3、 创建视频以及音频的流，并拷贝编解码器参数；

4、 打开输出音频和视频文件，并写入文件头；

5、 循环的读取输入帧，然后进行时间戳的转换。然后根据自己的设置（宏定义是1还是0）来选择是否要对视频进行avcC码流转annexB码流的操作。如果转换，则转换后写入过滤后的帧到输出视频文件中，如果不转换则直接写入。对于音频则直接写入。

6、 最后写入文件尾部；

需要注意的是，代码中输出音视频的码流格式需要自己控制，需要确定原视频中音视频码流的具体格式，根据源码流格式对输出码流的格式进行对应修改。例如，输入视频是.mp4，里面包含.h264的视频码流和.aac的音频码流，则代码中输出文件名的后缀就需要是.h264和.aac。

![image](https://github.com/zn111111/FFmpeg_Learning_Projects/assets/96569348/4f87de29-ac8b-4555-bc97-5086a5ea12b0)

一些解码器可能不支持avcC的h264码流，则需要将avcC码流转换为annexB码流，只需要将宏定义H264_AnnexB的值由0改为1即可。

## Usage

```shell
make
source ./profile.sh
./main before_conversion.mp4
```

